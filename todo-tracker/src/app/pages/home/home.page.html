<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Todo Tracker</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Logout
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Todo Tracker</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="ion-padding">
    <!-- Add Todo Form -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Add New Task</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-input 
            [(ngModel)]="newTodoTitle" 
            placeholder="Enter task..."
            (keyup.enter)="addTodo()"
            class="task-input">
          </ion-input>
          <ion-button 
            slot="end" 
            (click)="addTodo()"
            [disabled]="!newTodoTitle.trim()"
            color="primary">
            <ion-icon name="add-circle-outline" slot="start"></ion-icon>
            Add
          </ion-button>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Todo List -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Your Tasks ({{todos.length}})</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item 
            *ngFor="let todo of todos" 
            [class.completed]="todo.completed"
            class="todo-item">
            
            <!-- Checkbox for completion -->
            <ion-checkbox 
              slot="start" 
              [checked]="todo.completed"
              (ionChange)="toggleTodo(todo)"
              class="todo-checkbox">
            </ion-checkbox>
            
            <!-- Todo Content -->
            <ion-label [class.completed-text]="todo.completed" class="todo-content">
              <h2>{{todo.title}}</h2>
              <p *ngIf="todo.description" class="todo-description">{{todo.description}}</p>
              <p *ngIf="todo.dueDate" class="todo-due-date">
                <ion-icon name="calendar-outline" size="small"></ion-icon>
                Due: {{todo.dueDate | date}}
              </p>
            </ion-label>

            <!-- Action Buttons -->
            <div class="action-buttons" slot="end">
              <!-- Edit Button -->
              <ion-button 
                fill="clear" 
                color="warning"
                (click)="editTodo(todo)"
                class="action-button">
                <ion-icon name="create-outline"></ion-icon>
              </ion-button>
              
              <!-- Remove Button -->
              <ion-button 
                fill="clear" 
                color="danger"
                (click)="deleteTodo(todo.id)"
                class="action-button">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
        </ion-list>

        <!-- Empty State -->
        <ion-text *ngIf="todos.length === 0" color="medium">
          <div class="empty-state ion-text-center">
            <ion-icon name="checkmark-done-circle-outline" size="large"></ion-icon>
            <p>No tasks yet. Add your first task above!</p>
          </div>
        </ion-text>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>

<!-- Edit Todo Modal -->
<ion-modal [isOpen]="isEditModalOpen" (didDismiss)="closeEditModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-buttons slot="start">
          <ion-button (click)="closeEditModal()">Cancel</ion-button>
        </ion-buttons>
        <ion-title>Edit Task</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="saveEditedTodo()" [strong]="true">Save</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-item>
        <ion-label position="stacked">Task Title <ion-text color="danger">*</ion-text></ion-label>
        <ion-input 
          [(ngModel)]="editingTodo.title" 
          placeholder="Enter task title"
          class="edit-input">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Description</ion-label>
        <ion-textarea 
          [(ngModel)]="editingTodo.description" 
          placeholder="Add description (optional)"
          rows="3"
          class="edit-textarea">
        </ion-textarea>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Due Date</ion-label>
        <ion-input 
          type="date" 
          [(ngModel)]="editingTodo.dueDate"
          class="edit-input">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-checkbox [(ngModel)]="editingTodo.completed" slot="start"></ion-checkbox>
        <ion-label>Mark as completed</ion-label>
      </ion-item>
    </ion-content>
  </ng-template>
</ion-modal>
